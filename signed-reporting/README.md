# RansomEye Signed Reporting & Evidence Export Engine

**AUTHORITATIVE:** Deterministic, non-authoritative, regulator-grade signed reporting

## Purpose Statement

The Signed Reporting Engine produces **court-admissible, regulator-verifiable reports** derived only from Explanation Assembly (M6) and Audit Ledger. Reports are **signed**, **immutable**, and can be **re-verified years later**.

This engine **does NOT reinterpret or summarize**, **does NOT hide causality**, and **does NOT embed decision logic**.

**It renders views of truth, not opinions.**

> **"Signed reports present truth for humans without changing truth."**

## Why Reports Are Not Explanations

- **Explanation**: Creates explanation content (SEE, Alert Engine, UBA Alert Context, Risk Index, Explanation Assembly)
- **Report**: Renders already-assembled explanations into human-consumable formats (this engine)

This engine **does not explain events** — it **renders explanations for humans**.

## Why Reports Are Signed

Reports are signed to:

- **Establish authenticity**: Prove report was generated by RansomEye
- **Ensure integrity**: Detect any alteration after generation
- **Enable verification**: Allow offline verification by auditors/courts
- **Provide accountability**: Cryptographic proof of report origin
- **Support long-term verification**: Re-verify reports years later

## Core Principles

1. **Rendering ≠ reasoning**: Rendering does not involve reasoning or inference
2. **Export ≠ explanation**: Export does not create new explanations
3. **Format ≠ meaning**: Formatting does not change meaning
4. **Signature = accountability**: Signature provides cryptographic accountability

## Supported Formats (EXACTLY 3)

1. **PDF**: Human, court / board
   - Rendering profile: STANDARD_PDF
   - Use case: Court submissions, board presentations

2. **HTML**: Human, internal review
   - Rendering profile: STANDARD_HTML
   - Use case: Internal review, analyst consumption

3. **CSV**: Regulatory ingestion
   - Rendering profile: STANDARD_CSV
   - Use case: Regulatory system ingestion, automated processing

**No DOCX. No Markdown. No JSON (JSON remains internal truth only).**

## Architecture

### Data Flow

```
Explanation Assembly Engine (M6)
    ↓ (read-only)
Signed Reporting Engine
    ↓ (read-only)
Audit Ledger
    ↓
Rendered Report (signed, immutable)
    ↓
Human Audience / Court / Regulator
```

### Integration Points

1. **Explanation Assembly Engine (M6)**: Read-only consumption of assembled explanations
2. **Audit Ledger**: Read-only reference for anchoring
3. **Global Validator Public Keys**: Read-only for verification
4. **Report Signing Keys**: Separate keypair (ed25519)

## Schema

### Signed Report

All fields are **mandatory** (zero optional fields):

- `report_id` (UUID): Unique identifier
- `incident_id` (UUID): Incident identifier
- `assembled_explanation_id` (UUID): Assembled explanation identifier
- `view_type` (enum): View type (SOC_ANALYST, INCIDENT_COMMANDER, EXECUTIVE, REGULATOR)
- `format` (enum): Report format (PDF, HTML, CSV)
- `content_hash` (SHA256): Hash of rendered content
- `signature` (Base64): Cryptographic signature (ed25519)
- `signing_key_id` (string): Signing key identifier
- `generated_at` (RFC3339 UTC): Timestamp of generation
- `rendering_profile_id` (enum): Rendering profile (STANDARD_PDF, STANDARD_HTML, STANDARD_CSV)
- `audit_ledger_anchor` (UUID): Audit ledger entry identifier

## Cryptographic Choice

**Algorithm**: ed25519

**Justification**:
- Fast signing and verification
- Small signature size (64 bytes)
- Strong security (128-bit security level)
- Deterministic (RFC 8032)
- Widely supported in regulatory contexts
- Separate from Audit Ledger and Global Validator keys

## Court / Regulator Positioning

### Court Admissibility

- **Signed**: Cryptographic signature proves authenticity
- **Immutable**: Reports cannot be modified after generation
- **Verifiable**: Offline verification without RansomEye system
- **Traceable**: Full chain from report → explanation → ledger
- **Deterministic**: Same inputs → same outputs (reproducible)

### Regulator Verification

- **Content hash**: SHA256 hash enables integrity verification
- **Signature verification**: ed25519 signature enables authenticity verification
- **Audit trail**: Full audit trail from report generation
- **Long-term verification**: Reports can be verified years later
- **No interpretation**: Reports present truth without interpretation

## Chain-of-Custody Guarantees

1. **Report generation**: Anchored to audit ledger entry
2. **Content integrity**: SHA256 hash of rendered content
3. **Signature**: ed25519 signature of content
4. **Source traceability**: Full chain from report → explanation → source systems
5. **Immutable storage**: Reports cannot be modified after creation

## Long-Term Verification Model

Reports can be verified years later by:

1. **Content hash verification**: Recompute hash of rendered content
2. **Signature verification**: Verify ed25519 signature with public key
3. **Audit ledger verification**: Verify audit ledger entry
4. **Source explanation verification**: Verify assembled explanation integrity

**No RansomEye system required for verification** (offline verification).

## Failure Semantics

### Assembled Explanation Missing

- **Behavior**: Report generation fails with explicit error
- **Impact**: Report cannot be generated without assembled explanation
- **Recovery**: Ensure assembled explanation exists before report generation

### Signing Key Missing

- **Behavior**: Report generation fails
- **Impact**: Reports cannot be signed without signing key
- **Recovery**: Ensure signing key exists and is accessible

### Content Hash Mismatch

- **Behavior**: Validator detects hash mismatch
- **Impact**: Report integrity compromised
- **Recovery**: Rebuild report from audit ledger

## Validator Guarantees

The Global Validator can:

- **Recompute content_hash**: Re-render and verify hash
- **Verify signature**: Verify ed25519 signature with public key
- **Trace report → explanation → ledger**: Full traceability
- **Detect any alteration**: Hash and signature verification
- **Re-verify after export**: Offline verification capability

## Explicit Non-Features

This engine **MUST NOT**:

- ❌ Generate summaries
- ❌ Rewrite explanations
- ❌ Hide causality
- ❌ Add interpretation
- ❌ Add opinions
- ❌ Allow customization
- ❌ Allow partial export
- ❌ Mix view types
- ❌ Mix incidents

## Usage

### Generate Report

```bash
python3 signed-reporting/cli/generate_report.py \
    --incident-id <incident-uuid> \
    --view-type SOC_ANALYST \
    --format PDF \
    --assembly-store /var/lib/ransomeye/explanation-assembly/assemblies.jsonl \
    --assembly-ledger /var/lib/ransomeye/audit/ledger.jsonl \
    --assembly-ledger-key-dir /var/lib/ransomeye/audit/keys \
    --store /var/lib/ransomeye/signed-reporting/reports.jsonl \
    --ledger /var/lib/ransomeye/audit/ledger.jsonl \
    --ledger-key-dir /var/lib/ransomeye/audit/keys \
    --signing-key /var/lib/ransomeye/signed-reporting/keys/report_signing_key.pem \
    --signing-key-id report-signing-key-1 \
    --output report-record.json
```

### Verify Report

```bash
python3 signed-reporting/cli/verify_report.py \
    --report-id <report-uuid> \
    --store /var/lib/ransomeye/signed-reporting/reports.jsonl \
    --public-key /var/lib/ransomeye/signed-reporting/keys/report_signing_key.pub \
    --rendered-content /path/to/rendered-report.pdf
```

### Export Report

```bash
python3 signed-reporting/cli/export_report.py \
    --report-id <report-uuid> \
    --store /var/lib/ransomeye/signed-reporting/reports.jsonl \
    --assembly-store /var/lib/ransomeye/explanation-assembly/assemblies.jsonl \
    --assembly-ledger /var/lib/ransomeye/audit/ledger.jsonl \
    --assembly-ledger-key-dir /var/lib/ransomeye/audit/keys \
    --ledger /var/lib/ransomeye/audit/ledger.jsonl \
    --ledger-key-dir /var/lib/ransomeye/audit/keys \
    --signing-key /var/lib/ransomeye/signed-reporting/keys/report_signing_key.pem \
    --signing-key-id report-signing-key-1 \
    --output report.pdf
```

### Programmatic API

```python
from api.reporting_api import ReportingAPI

api = ReportingAPI(
    store_path=Path('/var/lib/ransomeye/signed-reporting/reports.jsonl'),
    ledger_path=Path('/var/lib/ransomeye/audit/ledger.jsonl'),
    ledger_key_dir=Path('/var/lib/ransomeye/audit/keys'),
    signing_key_path=Path('/var/lib/ransomeye/signed-reporting/keys/report_signing_key.pem'),
    signing_key_id='report-signing-key-1',
    assembly_store_path=Path('/var/lib/ransomeye/explanation-assembly/assemblies.jsonl'),
    assembly_ledger_path=Path('/var/lib/ransomeye/audit/ledger.jsonl'),
    assembly_ledger_key_dir=Path('/var/lib/ransomeye/audit/keys')
)

# Generate report
report = api.generate_report(
    incident_id='incident-uuid',
    view_type='SOC_ANALYST',
    format_type='PDF'
)

# Get report
report_record = api.get_report('report-uuid')

# List reports
reports = api.list_reports('incident-uuid')
```

## File Structure

```
signed-reporting/
├── schema/
│   └── signed-report.schema.json          # Frozen JSON schema
├── engine/
│   ├── __init__.py
│   ├── render_engine.py                  # Deterministic rendering engine
│   └── render_hasher.py                 # SHA256 hashing
├── crypto/
│   ├── __init__.py
│   ├── report_signer.py                 # ed25519 signing
│   └── report_verifier.py               # Offline verification
├── storage/
│   ├── __init__.py
│   └── report_store.py                  # Immutable, append-only storage
├── api/
│   ├── __init__.py
│   └── reporting_api.py                 # Reporting API
├── cli/
│   ├── __init__.py
│   ├── generate_report.py               # Generate report CLI
│   ├── verify_report.py                 # Verify report CLI
│   └── export_report.py                 # Export report CLI
└── README.md                             # This file
```

## Dependencies

- **Python 3.8+**: Required for type hints and pathlib
- **cryptography**: Required for ed25519 signing/verification
- **Audit Ledger**: Required for audit trail (separate subsystem)
- **Explanation Assembly Engine**: Required for assembled explanations (separate subsystem)

## Security Considerations

1. **Read-only inputs**: Never modifies source explanations
2. **Immutable storage**: Reports cannot be modified after creation
3. **Cryptographic signing**: ed25519 signature provides authenticity
4. **Content hashing**: SHA256 hash provides integrity
5. **Separate keys**: Signing keys separate from other subsystems
6. **Offline verification**: Reports can be verified without RansomEye system

## Final Statement

> **Reporting is the last mile of truth — not a new source of truth.**

---

**AUTHORITATIVE**: This is the single authoritative source for RansomEye Signed Reporting Engine documentation.
